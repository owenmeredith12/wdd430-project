{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/api/review/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport postgres from \"postgres\";\r\n\r\n// Connect to your database\r\nconst sql = postgres(process.env.POSTGRES_URL!, { ssl: \"require\" });\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const { productId, rating, userId } = await req.json();\r\n\r\n    // Validate input\r\n    if (!productId || !rating || !userId) {\r\n      return NextResponse.json({ error: \"Missing fields\" }, { status: 400 });\r\n    }\r\n    if (rating < 1 || rating > 5) {\r\n      return NextResponse.json({ error: \"Rating must be between 1 and 5\" }, { status: 400 });\r\n    }\r\n\r\n    // Insert review\r\n    const insertResult = await sql<{ id: string }[]>`\r\n      INSERT INTO reviews (product_id, rating, user_id)\r\n      VALUES (${productId}, ${rating}, ${userId})\r\n      RETURNING id\r\n    `;\r\n\r\n    if (!insertResult[0]) {\r\n      return NextResponse.json({ error: \"Failed to create review\" }, { status: 500 });\r\n    }\r\n\r\n    const reviewId = insertResult[0].id;\r\n\r\n    // Fetch inserted review with user name\r\n    const reviewData = await sql<{ id: string; rating: number; userName: string }[]>`\r\n      SELECT r.id, r.rating, u.name AS userName\r\n      FROM reviews r\r\n      JOIN users u ON r.user_id = u.id\r\n      WHERE r.id = ${reviewId}\r\n    `;\r\n\r\n    if (!reviewData[0]) {\r\n      return NextResponse.json({ error: \"Failed to fetch review\" }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ review: reviewData[0] });\r\n  } catch (error) {\r\n    console.error(\"Error adding review:\", error);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,2BAA2B;AAC3B,MAAM,MAAM,IAAA,qJAAQ,EAAC,QAAQ,GAAG,CAAC,YAAY,EAAG;IAAE,KAAK;AAAU;AAE1D,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,EAAE,SAAS,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QAEpD,iBAAiB;QACjB,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,QAAQ;YACpC,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACtE;QACA,IAAI,SAAS,KAAK,SAAS,GAAG;YAC5B,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiC,GAAG;gBAAE,QAAQ;YAAI;QACtF;QAEA,gBAAgB;QAChB,MAAM,eAAe,MAAM,GAAqB,CAAC;;cAEvC,EAAE,UAAU,EAAE,EAAE,OAAO,EAAE,EAAE,OAAO;;IAE5C,CAAC;QAED,IAAI,CAAC,YAAY,CAAC,EAAE,EAAE;YACpB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,WAAW,YAAY,CAAC,EAAE,CAAC,EAAE;QAEnC,uCAAuC;QACvC,MAAM,aAAa,MAAM,GAAuD,CAAC;;;;mBAIlE,EAAE,SAAS;IAC1B,CAAC;QAED,IAAI,CAAC,UAAU,CAAC,EAAE,EAAE;YAClB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAC9E;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ,UAAU,CAAC,EAAE;QAAC;IACnD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}