{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/api/product/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport postgres from \"postgres\";\r\n\r\n// Connect to your database\r\nconst sql = postgres(process.env.POSTGRES_URL!, { ssl: \"require\" });\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json(\r\n        { error: \"Product ID is required\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Fetch the product\r\n    const product = await sql<{\r\n      id: string;\r\n      name: string;\r\n      description: string;\r\n      price: number;\r\n      image_url?: string;\r\n    }[]>`\r\n      SELECT id, name, description, price, image_url\r\n      FROM products\r\n      WHERE id = ${id}\r\n      LIMIT 1\r\n    `;\r\n\r\n    if (!product[0]) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid product ID\" },\r\n        { status: 404 }\r\n      );\r\n    }\r\n\r\n    // Fetch reviews (no users table join)\r\n    const reviews = await sql<{\r\n      id: string;\r\n      rating: number;\r\n      userName: string;\r\n    }[]>`\r\n      SELECT r.id, r.rating, 'Anonymous' AS userName\r\n      FROM reviews r\r\n      WHERE r.product_id = ${id}\r\n      ORDER BY r.id DESC\r\n    `;\r\n\r\n    // Return product and reviews\r\n    return NextResponse.json({\r\n      product: { ...product[0], imageUrl: product[0].image_url || \"\" },\r\n      reviews,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error fetching product:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Internal Server Error\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    // Parse the request body\r\n    const { name, description, price, image_url, artisan_id } = await req.json();\r\n\r\n    // Validate required fields\r\n    if (!name || !description || !price || !artisan_id) {\r\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\r\n    }\r\n\r\n    // Insert new product into the database\r\n    const result = await sql<{ id: string }[]>`\r\n      INSERT INTO products (name, description, price, image_url, artisan_id)\r\n      VALUES (${name}, ${description}, ${price}, ${image_url}, ${artisan_id})\r\n      RETURNING id\r\n    `;\r\n\r\n    if (!result[0]) {\r\n      return NextResponse.json({ error: \"Failed to create product\" }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ product: result[0] });\r\n  } catch (err) {\r\n    console.error(\"Error creating product:\", err);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,2BAA2B;AAC3B,MAAM,MAAM,IAAA,qJAAQ,EAAC,QAAQ,GAAG,CAAC,YAAY,EAAG;IAAE,KAAK;AAAU;AAE1D,eAAe,IAAI,GAAgB;IACxC,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,MAAM,KAAK,aAAa,GAAG,CAAC;QAE5B,IAAI,CAAC,IAAI;YACP,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,oBAAoB;QACpB,MAAM,UAAU,MAAM,GAMlB,CAAC;;;iBAGQ,EAAE,GAAG;;IAElB,CAAC;QAED,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE;YACf,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,sCAAsC;QACtC,MAAM,UAAU,MAAM,GAIlB,CAAC;;;2BAGkB,EAAE,GAAG;;IAE5B,CAAC;QAED,6BAA6B;QAC7B,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;gBAAE,GAAG,OAAO,CAAC,EAAE;gBAAE,UAAU,OAAO,CAAC,EAAE,CAAC,SAAS,IAAI;YAAG;YAC/D;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,yBAAyB;QACzB,MAAM,EAAE,IAAI,EAAE,WAAW,EAAE,KAAK,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG,MAAM,IAAI,IAAI;QAE1E,2BAA2B;QAC3B,IAAI,CAAC,QAAQ,CAAC,eAAe,CAAC,SAAS,CAAC,YAAY;YAClD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,uCAAuC;QACvC,MAAM,SAAS,MAAM,GAAqB,CAAC;;cAEjC,EAAE,KAAK,EAAE,EAAE,YAAY,EAAE,EAAE,MAAM,EAAE,EAAE,UAAU,EAAE,EAAE,WAAW;;IAExE,CAAC;QAED,IAAI,CAAC,MAAM,CAAC,EAAE,EAAE;YACd,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS,MAAM,CAAC,EAAE;QAAC;IAChD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}