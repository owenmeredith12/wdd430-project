{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from \"next-auth\"\r\nimport CredentialsProvider from \"next-auth/providers/credentials\"\r\nimport { compare } from \"bcryptjs\"\r\nimport postgres from \"postgres\"\r\n\r\nexport const runtime = \"nodejs\"\r\n\r\n// PostgreSQL connection setup\r\nconst sql = postgres(process.env.POSTGRES_URL!, { ssl: \"require\" })\r\n\r\n// NextAuth.js options configuration\r\nexport const authOptions: NextAuthOptions = {\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n  session: { \r\n    strategy: \"jwt\",\r\n  },\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: \"Credentials\",\r\n      credentials: {\r\n        email: { label: \"Email\", type: \"email\" },\r\n        password: { label: \"Password\", type: \"password\" },\r\n      },\r\n      async authorize(credentials) {\r\n        try {\r\n          if (!credentials?.email || !credentials?.password) {\r\n            throw new Error(\"Incorrect username or password\")\r\n          }\r\n\r\n          // Fetch the user from PostgreSQL database\r\n          const result = await sql`\r\n            SELECT id, email, password, name\r\n            FROM users\r\n            WHERE email = ${credentials.email}\r\n            LIMIT 1\r\n          `\r\n          const user = result[0]\r\n\r\n          // If user is not found, throw error\r\n          if (!user) throw new Error(\"Incorrect username or password\")\r\n\r\n          // Compare the hashed password with the provided password\r\n          const isValid = await compare(credentials.password, user.password)\r\n          if (!isValid) throw new Error(\"Incorrect username or password\")\r\n\r\n          // Return user object to be included in the JWT token\r\n          return { id: user.id, email: user.email, name: user.name }\r\n        } catch (err: any) {\r\n          console.error(\"Error during user authorization:\", err)\r\n          // Throw the error to be handled by NextAuth\r\n          throw new Error(err.message || \"Authentication error\")\r\n        }\r\n      },\r\n    }),\r\n  ],\r\n  pages: {\r\n    signIn: \"/login\",\r\n  },\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.id = user.id\r\n        token.email = user.email\r\n        token.name = user.name\r\n      }\r\n      return token\r\n    },\r\n    async session({ session, token }) {\r\n      if (token) {\r\n        session.user = session.user || {}\r\n        session.user.email = token.email\r\n        session.user.name = token.name\r\n      }\r\n      return session\r\n    }\r\n  }\r\n}\r\n\r\n// NextAuth handler\r\nconst handler = NextAuth(authOptions)\r\n\r\nexport { handler as GET, handler as POST }\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAM,UAAU;AAEvB,8BAA8B;AAC9B,MAAM,MAAM,IAAA,mJAAQ,EAAC,QAAQ,GAAG,CAAC,YAAY,EAAG;IAAE,KAAK;AAAU;AAG1D,MAAM,cAA+B;IAC1C,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,IAAA,mKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI;oBACF,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;wBACjD,MAAM,IAAI,MAAM;oBAClB;oBAEA,0CAA0C;oBAC1C,MAAM,SAAS,MAAM,GAAG,CAAC;;;0BAGT,EAAE,YAAY,KAAK,CAAC;;UAEpC,CAAC;oBACD,MAAM,OAAO,MAAM,CAAC,EAAE;oBAEtB,oCAAoC;oBACpC,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;oBAE3B,yDAAyD;oBACzD,MAAM,UAAU,MAAM,IAAA,4IAAO,EAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;oBACjE,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;oBAE9B,qDAAqD;oBACrD,OAAO;wBAAE,IAAI,KAAK,EAAE;wBAAE,OAAO,KAAK,KAAK;wBAAE,MAAM,KAAK,IAAI;oBAAC;gBAC3D,EAAE,OAAO,KAAU;oBACjB,QAAQ,KAAK,CAAC,oCAAoC;oBAClD,4CAA4C;oBAC5C,MAAM,IAAI,MAAM,IAAI,OAAO,IAAI;gBACjC;YACF;QACF;KACD;IACD,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,KAAK,GAAG,KAAK,KAAK;gBACxB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,OAAO;gBACT,QAAQ,IAAI,GAAG,QAAQ,IAAI,IAAI,CAAC;gBAChC,QAAQ,IAAI,CAAC,KAAK,GAAG,MAAM,KAAK;gBAChC,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YACA,OAAO;QACT;IACF;AACF;AAEA,mBAAmB;AACnB,MAAM,UAAU,IAAA,gJAAQ,EAAC"}},
    {"offset": {"line": 210, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/components/ui/card.tsx"],"sourcesContent":["import { ReactNode } from \"react\";\r\nimport clsx from \"clsx\";\r\n\r\nexport function Card({\r\n  children,\r\n  className,\r\n}: {\r\n  children: ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div\r\n      className={clsx(\r\n        \"border rounded-2xl shadow-sm bg-white p-4\",\r\n        \"transition hover:shadow-md\",\r\n        className\r\n      )}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function CardHeader({\r\n  children,\r\n  className,\r\n}: {\r\n  children: ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <div className={clsx(\"mb-3\", className)}>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport function CardTitle({\r\n  children,\r\n  className,\r\n}: {\r\n  children: ReactNode;\r\n  className?: string;\r\n}) {\r\n  return (\r\n    <h2\r\n      className={clsx(\r\n        \"text-xl font-semibold leading-tight truncate\",\r\n        className\r\n      )}\r\n    >\r\n      {children}\r\n    </h2>\r\n  );\r\n}\r\n\r\nexport function CardContent({\r\n  children,\r\n  className,\r\n}: {\r\n  children: ReactNode;\r\n  className?: string;\r\n}) {\r\n  return <div className={clsx(\"mt-2\", className)}>{children}</div>;\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;;AACA;;;AAEO,SAAS,KAAK,EACnB,QAAQ,EACR,SAAS,EAIV;IACC,qBACE,8OAAC;QACC,WAAW,IAAA,gJAAI,EACb,6CACA,8BACA;kBAGD;;;;;;AAGP;AAEO,SAAS,WAAW,EACzB,QAAQ,EACR,SAAS,EAIV;IACC,qBACE,8OAAC;QAAI,WAAW,IAAA,gJAAI,EAAC,QAAQ;kBAC1B;;;;;;AAGP;AAEO,SAAS,UAAU,EACxB,QAAQ,EACR,SAAS,EAIV;IACC,qBACE,8OAAC;QACC,WAAW,IAAA,gJAAI,EACb,gDACA;kBAGD;;;;;;AAGP;AAEO,SAAS,YAAY,EAC1B,QAAQ,EACR,SAAS,EAIV;IACC,qBAAO,8OAAC;QAAI,WAAW,IAAA,gJAAI,EAAC,QAAQ;kBAAa;;;;;;AACnD"}},
    {"offset": {"line": 268, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/components/ui/button.tsx"],"sourcesContent":["import clsx from 'clsx';\r\n\r\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n  children: React.ReactNode;\r\n}\r\n\r\nexport function Button({ children, className, ...rest }: ButtonProps) {\r\n  return (\r\n    <button\r\n      {...rest}\r\n      className={clsx(\r\n        'flex h-10 items-center rounded-lg bg-blue-500 px-4 text-sm font-medium text-white transition-colors hover:bg-blue-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-500 active:bg-blue-600 aria-disabled:cursor-not-allowed aria-disabled:opacity-50',\r\n        className,\r\n      )}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n}"],"names":[],"mappings":";;;;;AAAA;;;AAMO,SAAS,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,GAAG,MAAmB;IAClE,qBACE,8OAAC;QACE,GAAG,IAAI;QACR,WAAW,IAAA,gJAAI,EACb,kTACA;kBAGD;;;;;;AAGP"}},
    {"offset": {"line": 291, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/account/page.tsx"],"sourcesContent":["import { getServerSession } from \"next-auth/next\"\r\nimport { redirect } from \"next/navigation\"\r\nimport { authOptions } from \"../api/auth/[...nextauth]/route\"\r\nimport postgres from \"postgres\"\r\nimport Image from \"next/image\"\r\nimport { Card, CardHeader, CardTitle, CardContent } from \"../components/ui/card\"\r\nimport { Button } from \"../components/ui/button\"\r\n\r\n// PostgreSQL connection\r\nconst sql = postgres(process.env.POSTGRES_URL!, { ssl: \"require\" })\r\n\r\ntype Product = {\r\n  id: string\r\n  name: string\r\n  description: string\r\n  price: number\r\n  image_url?: string | null\r\n}\r\n\r\nexport default async function AccountPage() {\r\n  // Get the user session\r\n  const session = await getServerSession(authOptions)\r\n  if (!session) redirect(\"/login\")\r\n\r\nconst { user } = session\r\n\r\n  // Find the artisan associated with this username\r\nconst artisanResult = await sql`\r\n  SELECT a.id\r\n  FROM artisans a\r\n  JOIN users u ON u.id = a.user_id\r\n  WHERE u.name = ${user.name}\r\n  LIMIT 1\r\n`\r\n  const artisanId = artisanResult[0]?.id\r\n\r\n  if (!artisanId) {\r\n    return (\r\n      <div className=\"p-10\">\r\n        <h1 className=\"text-3xl font-bold\">Account Page</h1>\r\n        <p className=\"mt-4 text-lg\">No artisan profile found for this user.</p>\r\n      </div>\r\n    )\r\n  }\r\n\r\n  // Fetch products for this artisan\r\n  const products = await sql<Product[]>`\r\n    SELECT id, name, description, price, image_url\r\n    FROM products\r\n    WHERE artisan_id = ${artisanId}\r\n  `\r\n\r\n  return (\r\n    <div className=\"p-10 max-w-7xl mx-auto\">\r\n      <h1 className=\"text-3xl font-bold mb-6\">Your Products</h1>\r\n      <p className=\"mb-8 text-lg\">\r\n        Welcome, {user.name || user.email}\r\n      </p>\r\n\r\n      {products.length === 0 && (\r\n        <p className=\"text-gray-500\">You have no products yet.</p>\r\n      )}\r\n\r\n      <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6\">\r\n        {products.map((product) => (\r\n          <Card key={product.id} className=\"rounded-2xl shadow-sm hover:shadow-md transition\">\r\n            <CardHeader>\r\n              <CardTitle className=\"text-xl font-semibold truncate\">\r\n                {product.name}\r\n              </CardTitle>\r\n            </CardHeader>\r\n            <CardContent>\r\n              {product.image_url && (\r\n                <div className=\"relative w-full h-48 mb-4 rounded-xl overflow-hidden\">\r\n                  <Image\r\n                    src={product.image_url}\r\n                    alt={product.name}\r\n                    fill\r\n                    className=\"object-cover\"\r\n                  />\r\n                </div>\r\n              )}\r\n              <p className=\"text-gray-700 mb-4 line-clamp-3\">{product.description}</p>\r\n              <p className=\"text-lg font-medium mb-4\">${product.price}</p>\r\n              <Button className=\"w-full rounded-xl\">Edit Product</Button>\r\n            </CardContent>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\n\r\n// // app/account/page.tsx\r\n// import { getServerSession } from \"next-auth/next\"\r\n// import { redirect } from \"next/navigation\"\r\n// import { authOptions } from \"../api/auth/[...nextauth]/route\"\r\n\r\n// export default async function AccountPage() {\r\n//   let session = null\r\n\r\n//   try {\r\n//     // Fetch the server session\r\n//     session = await getServerSession(authOptions)\r\n//   } catch (err) {\r\n//     console.error(\"Error fetching session:\", err)\r\n//     // If session fetch fails, redirect to login\r\n//     redirect(\"/login\")\r\n//   }\r\n\r\n//   // If user is not authenticated, redirect to login\r\n//   if (!session) redirect(\"/login\")\r\n\r\n//   // Render the protected page\r\n//   return (\r\n//     <div className=\"p-10\">\r\n//       <h1 className=\"text-3xl font-bold\">Account Page</h1>\r\n//       <p className=\"mt-4 text-lg\">\r\n//         Welcome, {session.user?.name || session.user?.email}\r\n//       </p>\r\n//     </div>\r\n//   )\r\n// }\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA,wBAAwB;AACxB,MAAM,MAAM,IAAA,mJAAQ,EAAC,QAAQ,GAAG,CAAC,YAAY,EAAG;IAAE,KAAK;AAAU;AAUlD,eAAe;IAC5B,uBAAuB;IACvB,MAAM,UAAU,MAAM,IAAA,iKAAgB,EAAC,uKAAW;IAClD,IAAI,CAAC,SAAS,IAAA,iMAAQ,EAAC;IAEzB,MAAM,EAAE,IAAI,EAAE,GAAG;IAEf,iDAAiD;IACnD,MAAM,gBAAgB,MAAM,GAAG,CAAC;;;;iBAIf,EAAE,KAAK,IAAI,CAAC;;AAE7B,CAAC;IACC,MAAM,YAAY,aAAa,CAAC,EAAE,EAAE;IAEpC,IAAI,CAAC,WAAW;QACd,qBACE,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAAqB;;;;;;8BACnC,8OAAC;oBAAE,WAAU;8BAAe;;;;;;;;;;;;IAGlC;IAEA,kCAAkC;IAClC,MAAM,WAAW,MAAM,GAAc,CAAC;;;uBAGjB,EAAE,UAAU;EACjC,CAAC;IAED,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAA0B;;;;;;0BACxC,8OAAC;gBAAE,WAAU;;oBAAe;oBAChB,KAAK,IAAI,IAAI,KAAK,KAAK;;;;;;;YAGlC,SAAS,MAAM,KAAK,mBACnB,8OAAC;gBAAE,WAAU;0BAAgB;;;;;;0BAG/B,8OAAC;gBAAI,WAAU;0BACZ,SAAS,GAAG,CAAC,CAAC,wBACb,8OAAC,+IAAI;wBAAkB,WAAU;;0CAC/B,8OAAC,qJAAU;0CACT,cAAA,8OAAC,oJAAS;oCAAC,WAAU;8CAClB,QAAQ,IAAI;;;;;;;;;;;0CAGjB,8OAAC,sJAAW;;oCACT,QAAQ,SAAS,kBAChB,8OAAC;wCAAI,WAAU;kDACb,cAAA,8OAAC,wIAAK;4CACJ,KAAK,QAAQ,SAAS;4CACtB,KAAK,QAAQ,IAAI;4CACjB,IAAI;4CACJ,WAAU;;;;;;;;;;;kDAIhB,8OAAC;wCAAE,WAAU;kDAAmC,QAAQ,WAAW;;;;;;kDACnE,8OAAC;wCAAE,WAAU;;4CAA2B;4CAAE,QAAQ,KAAK;;;;;;;kDACvD,8OAAC,mJAAM;wCAAC,WAAU;kDAAoB;;;;;;;;;;;;;uBAnB/B,QAAQ,EAAE;;;;;;;;;;;;;;;;AA0B/B,EAGA,0BAA0B;CAC1B,oDAAoD;CACpD,6CAA6C;CAC7C,gEAAgE;CAEhE,gDAAgD;CAChD,uBAAuB;CAEvB,UAAU;CACV,kCAAkC;CAClC,oDAAoD;CACpD,oBAAoB;CACpB,oDAAoD;CACpD,mDAAmD;CACnD,yBAAyB;CACzB,MAAM;CAEN,uDAAuD;CACvD,qCAAqC;CAErC,iCAAiC;CACjC,aAAa;CACb,6BAA6B;CAC7B,6DAA6D;CAC7D,qCAAqC;CACrC,+DAA+D;CAC/D,aAAa;CACb,aAAa;CACb,MAAM;CACN,IAAI"}}]
}