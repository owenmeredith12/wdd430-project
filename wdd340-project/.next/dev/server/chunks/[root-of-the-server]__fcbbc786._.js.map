{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { NextAuthOptions } from \"next-auth\"\r\nimport CredentialsProvider from \"next-auth/providers/credentials\"\r\nimport { compare } from \"bcryptjs\"\r\nimport postgres from \"postgres\"\r\n\r\nexport const runtime = \"nodejs\"\r\n\r\n// PostgreSQL connection setup\r\nconst sql = postgres(process.env.POSTGRES_URL!, { ssl: \"require\" })\r\n\r\n// NextAuth.js options configuration\r\nexport const authOptions: NextAuthOptions = {\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n  session: { \r\n    strategy: \"jwt\",\r\n  },\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: \"Credentials\",\r\n      credentials: {\r\n        email: { label: \"Email\", type: \"email\" },\r\n        password: { label: \"Password\", type: \"password\" },\r\n      },\r\n      async authorize(credentials) {\r\n        try {\r\n          if (!credentials?.email || !credentials?.password) {\r\n            throw new Error(\"Incorrect username or password\")\r\n          }\r\n\r\n          // Fetch the user from PostgreSQL database\r\n          const result = await sql`\r\n            SELECT id, email, password, name\r\n            FROM users\r\n            WHERE email = ${credentials.email}\r\n            LIMIT 1\r\n          `\r\n          const user = result[0]\r\n\r\n          // If user is not found, throw error\r\n          if (!user) throw new Error(\"Incorrect username or password\")\r\n\r\n          // Compare the hashed password with the provided password\r\n          const isValid = await compare(credentials.password, user.password)\r\n          if (!isValid) throw new Error(\"Incorrect username or password\")\r\n\r\n          // Return user object to be included in the JWT token\r\n          return { id: user.id, email: user.email, name: user.name }\r\n        } catch (err: any) {\r\n          console.error(\"Error during user authorization:\", err)\r\n          // Throw the error to be handled by NextAuth\r\n          throw new Error(err.message || \"Authentication error\")\r\n        }\r\n      },\r\n    }),\r\n  ],\r\n  pages: {\r\n    signIn: \"/login\",\r\n  },\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.id = user.id\r\n        token.email = user.email\r\n        token.name = user.name\r\n      }\r\n      return token\r\n    },\r\n    async session({ session, token }) {\r\n      if (token) {\r\n        session.user = session.user || {}\r\n        session.user.email = token.email\r\n        session.user.name = token.name\r\n      }\r\n      return session\r\n    }\r\n  }\r\n}\r\n\r\n// NextAuth handler\r\nconst handler = NextAuth(authOptions)\r\n\r\nexport { handler as GET, handler as POST }\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEO,MAAM,UAAU;AAEvB,8BAA8B;AAC9B,MAAM,MAAM,IAAA,qJAAQ,EAAC,QAAQ,GAAG,CAAC,YAAY,EAAG;IAAE,KAAK;AAAU;AAG1D,MAAM,cAA+B;IAC1C,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACnC,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,IAAA,qKAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAQ;gBACvC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI;oBACF,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;wBACjD,MAAM,IAAI,MAAM;oBAClB;oBAEA,0CAA0C;oBAC1C,MAAM,SAAS,MAAM,GAAG,CAAC;;;0BAGT,EAAE,YAAY,KAAK,CAAC;;UAEpC,CAAC;oBACD,MAAM,OAAO,MAAM,CAAC,EAAE;oBAEtB,oCAAoC;oBACpC,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;oBAE3B,yDAAyD;oBACzD,MAAM,UAAU,MAAM,IAAA,8IAAO,EAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;oBACjE,IAAI,CAAC,SAAS,MAAM,IAAI,MAAM;oBAE9B,qDAAqD;oBACrD,OAAO;wBAAE,IAAI,KAAK,EAAE;wBAAE,OAAO,KAAK,KAAK;wBAAE,MAAM,KAAK,IAAI;oBAAC;gBAC3D,EAAE,OAAO,KAAU;oBACjB,QAAQ,KAAK,CAAC,oCAAoC;oBAClD,4CAA4C;oBAC5C,MAAM,IAAI,MAAM,IAAI,OAAO,IAAI;gBACjC;YACF;QACF;KACD;IACD,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,KAAK,GAAG,KAAK,KAAK;gBACxB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,OAAO;gBACT,QAAQ,IAAI,GAAG,QAAQ,IAAI,IAAI,CAAC;gBAChC,QAAQ,IAAI,CAAC,KAAK,GAAG,MAAM,KAAK;gBAChC,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YACA,OAAO;QACT;IACF;AACF;AAEA,mBAAmB;AACnB,MAAM,UAAU,IAAA,kJAAQ,EAAC"}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Owner/Documents/wdd430/wdd430-project/wdd340-project/src/app/api/product/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { getServerSession } from \"next-auth/next\";\r\nimport { authOptions } from \"../auth/[...nextauth]/route\"; // adjust path if needed\r\nimport postgres from \"postgres\";\r\n\r\n// Connect to your database\r\nconst sql = postgres(process.env.POSTGRES_URL!, { ssl: \"require\" });\r\n\r\nexport async function GET(req: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(req.url);\r\n    const id = searchParams.get(\"id\");\r\n\r\n    if (!id) {\r\n      return NextResponse.json({ error: \"Product ID is required\" }, { status: 400 });\r\n    }\r\n\r\n    // Fetch the product\r\n    const product = await sql<{\r\n      id: string;\r\n      name: string;\r\n      description: string;\r\n      price: number;\r\n      image_url?: string;\r\n    }[]>`\r\n      SELECT id, name, description, price, image_url\r\n      FROM products\r\n      WHERE id = ${id}\r\n      LIMIT 1\r\n    `;\r\n\r\n    if (!product[0]) {\r\n      return NextResponse.json({ error: \"Invalid product ID\" }, { status: 404 });\r\n    }\r\n\r\n    // Fetch reviews (anonymous)\r\nconst reviews = await sql<{\r\n  id: string;\r\n  rating: number;\r\n  comment: string;\r\n  userName: string;\r\n}[]>`\r\n  SELECT r.id, r.rating, r.comment, 'Anonymous' AS userName\r\n  FROM reviews r\r\n  WHERE r.product_id = ${id}\r\n  ORDER BY r.id DESC\r\n`;\r\n\r\n    // Return product and reviews\r\n    return NextResponse.json({\r\n      product: { ...product[0], imageUrl: product[0].image_url || \"\" },\r\n      reviews,\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error fetching product:\", error);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    // Get session to determine artisan\r\n    const session = await getServerSession(authOptions);\r\n    if (!session?.user?.name) {\r\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n    }\r\n\r\n    // Parse request body\r\n    const { name, description, price, image_url } = await req.json();\r\n\r\n    if (!name || !description || !price) {\r\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\r\n    }\r\n\r\n    // Get artisan ID for this user\r\n    const artisanResult = await sql<{ id: string }[]>`\r\n      SELECT a.id\r\n      FROM artisans a\r\n      JOIN users u ON u.id = a.user_id\r\n      WHERE u.name = ${session.user.name}\r\n      LIMIT 1\r\n    `;\r\n\r\n    const artisan_id = artisanResult[0]?.id;\r\n    if (!artisan_id) {\r\n      return NextResponse.json({ error: \"No artisan profile found\" }, { status: 400 });\r\n    }\r\n\r\n    // Insert new product\r\n    const result = await sql<{ id: string }[]>`\r\n      INSERT INTO products (name, description, price, image_url, artisan_id)\r\n      VALUES (${name}, ${description}, ${price}, ${image_url}, ${artisan_id})\r\n      RETURNING id\r\n    `;\r\n\r\n    return NextResponse.json({ product: result[0] });\r\n  } catch (err) {\r\n    console.error(\"Error creating product:\", err);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n\r\nexport async function PUT(req: NextRequest) {\r\n  try {\r\n    const { id, name, description, price, image_url } = await req.json();\r\n\r\n    if (!id || !name || !description || !price) {\r\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 });\r\n    }\r\n\r\n    const result = await sql<{ id: string }[]>`\r\n      UPDATE products\r\n      SET name = ${name},\r\n          description = ${description},\r\n          price = ${price},\r\n          image_url = ${image_url}\r\n      WHERE id = ${id}\r\n      RETURNING id\r\n    `;\r\n\r\n    if (!result[0]) {\r\n      return NextResponse.json({ error: \"Failed to update product\" }, { status: 500 });\r\n    }\r\n\r\n    return NextResponse.json({ product: result[0] });\r\n  } catch (err) {\r\n    console.error(\"Error updating product:\", err);\r\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}